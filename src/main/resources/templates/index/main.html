<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:form="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>é—¨æˆ·é¡µé¢</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/resources/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="/resources/css/public.css" media="all"/>
    <link rel="stylesheet" href="/resources/css/cate.css" media="all"/>
</head>
<body class="childrenBody">

<!--æ—¶é—´ä¿¡æ¯æ¿å—-->
<blockquote class="layui-elem-quote layui-bg-green layui-row">
    <div id="nowTime"></div>
    <div id="nextTime"></div>
</blockquote>

<!--å…¶ä»–ä¿¡æ¯æ¿å—-->
<div class="layui-row layui-col-space10">
    <!--å·¦éƒ¨åˆ†æ¿å—-->
    <div class="layui-col-lg6 layui-col-md12">
        <blockquote class="layui-elem-quote title">æœ€å—æ¬¢è¿çš„ä¹¦ç±æ’è¡Œ</blockquote>
        <div class="mainmenu">
            <img src="/resources/images/5_top.jpg" height="8" class="bottom" alt=""/>
            <div id="bookRack_popular"></div>
        </div>
        <hr>
        <blockquote class="layui-elem-quote title">å€Ÿé˜…å‰åæ’è¡Œæ¦œ</blockquote>
        <table id="userGrade" lay-filter="userGrade"></table>
    </div>

    <!--å³éƒ¨åˆ†æ¿å—-->
    <div class="layui-col-lg6 layui-col-md12">
        <blockquote class="layui-elem-quote title">æœ€æ–°ä¸Šæ¶çš„ä¹¦ç±æ’è¡Œ<i class="layui-icon layui-red">&#xe756;</i></blockquote>
        <div class="mainmenu">
            <img src="/resources/images/5_top.jpg" height="8" class="bottom" alt=""/>
            <div id="bookRack_putaway"></div>
        </div>
        <hr>
        <blockquote class="layui-elem-quote title">å›¾ä¹¦åˆ†ç±»æ¯”ä¾‹</blockquote>
        <!-- ä¸ºEChartså‡†å¤‡ä¸€ä¸ªå…·å¤‡å¤§å°ï¼ˆå®½é«˜ï¼‰çš„Dom -->
        <div id="mainECharts" style="width: 600px; height:400px;"></div>
    </div>
</div>

<!-- æ·»åŠ å’Œä¿®æ”¹çš„å¼¹å‡ºå±‚å¼€å§‹ -->
<div style="display: none; padding: 5px" id="addOrUpdateLayer">
    <form action="" method="post" class="layui-form layui-form-pane" id="addOrUpdateForm" lay-filter="dataFrm">

        <div class="layui-form-item">
            <label class="layui-form-label" for="expectTime">è¿˜ä¹¦æ—¶é—´</label>
            <div class="layui-input-block">
                <input type="hidden" name="booknum" id="booknum2">
                <input type="text" name="expectTime" id="expectTime" readonly lay-verify="required" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" for="content">å€Ÿé˜…å…¬å‘Š</label>
            <div class="layui-input-block">
                <form:textarea class="layui-textarea" id="content" htmlEscape="true" readonly>
                    äº²çˆ±çš„åŒå­¦ï¼š<br>
                    &emsp;&emsp;å¤§å®¶å¥½ï¼<br>
                    &emsp;&emsp;å¾ˆé«˜å…´åŒå­¦èƒ½å¤Ÿç§¯æå‚ä¸åˆ°è¯¾å¤–é˜…è¯»ä¸­æå‡è‡ªå·±çš„è§†é‡ï¼Œæˆ‘ä»¬ä¹Ÿç§¯æé…åˆåŒå­¦ä»¬çš„é˜…è¯»å€Ÿé˜…å·¥ä½œã€‚
                    ä½†æ˜¯è¿˜è¯·æ³¨æ„ï¼Œç”±äºæœ¬å›¾ä¹¦é¦†çš„å›¾ä¹¦å±äº<span style="color: #01AAED">å…¬å…±èµ„æº</span>ï¼Œè¿˜è¯·å„ä½åŒå­¦å€Ÿé˜…ä¹‹åå¥½å¥½ä¿ç®¡ï¼Œä»¥ä¾¿å…¶ä»–çš„åŒå­¦ä»¬è¿›è¡Œå€Ÿé˜…ã€‚
                    å¦å¤–ï¼Œè¿˜è¯·æ³¨æ„è‡ªå·±å¡«å†™çš„å€Ÿé˜…å½’è¿˜æ—¶é—´ï¼Œé€¾æ—¶æœªå½’è¿˜æ˜¯ä¼šæ‰£é™¤ä¸€å®šçš„<span style="color: #ff6700">æŠ¼é‡‘</span>ï¼Œå¹¶å½±å“ä¿¡èª‰çš„å“¦ï¼<br>
                    &emsp;&emsp;ç¥å¤§å®¶åšå­¦ä¹‹ï¼Œå®¡é—®ä¹‹ï¼Œæ…æ€ä¹‹ï¼Œæ˜è¾¨ä¹‹ï¼Œç¬ƒè¡Œä¹‹ã€‚<br>
                    <hr class="layui-bg-blue">
                    <b>è§„å®šï¼š</b><br>
                    &emsp;&emsp;1ã€å€Ÿé˜…å½’è¿˜æ—¶é—´èŒƒå›´ä¸º<span style="color: #01AAED">å€Ÿé˜…ä¹¦ç±çš„ç¬¬äºŒå¤©å¼€å§‹è‡³ä¸‹ä¸ªæœˆçš„ä»Šå¤©æˆªæ­¢</span>ã€‚<br>
                    &emsp;&emsp;2ã€é€¾æ—¶ä¸€å¤©æœªå½’è¿˜å°†æ‰£é™¤æ‚¨çš„æŠ¼é‡‘ï¼Œ<span style="color: #ff6700">æ¯å¤©æ‰£é™¤0.2å…ƒï¼Œä¾æ¬¡ç´¯åŠ </span>ï¼Œç›´è‡³å½’è¿˜ã€‚<br>
                </form:textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-blocklayer-footer" style="text-align: center; float: bottom; ">
                <button type="button" class="layui-btn" lay-submit="" lay-filter="addBorrow" id="doSubmit">
                    <span class="layui-icon layui-icon-ok"></span> ç¡®å®š
                </button>
                <button type="reset" class="layui-btn layui-btn-warm" id="doReset">
                    <span class="layui-icon layui-icon-refresh-1"></span> é‡ç½®
                </button>
            </div>
        </div>
    </form>
</div>
<!-- æ·»åŠ å’Œä¿®æ”¹çš„å¼¹å‡ºå±‚ç»“æŸ -->

<!--æ’è¡Œæ¦œå›¾æ ‡-->
<script type="text/html" id="gradeIcon">
    {{#  if(d.rank == 1){ }}
    <span class="seraph vip1 icon-vip1"></span>
    {{#  } else if(d.rank == 2){ }}
    <span class="seraph vip2 icon-vip2"></span>
    {{#  } else if(d.rank == 3){ }}
    <span class="seraph vip3 icon-vip3"></span>
    {{#  } else if(d.rank == 4){ }}
    <span class="seraph vip4 icon-vip4"></span>
    {{#  } else if(d.rank == 5){ }}
    <span class="seraph vip5 icon-vip5"></span>
    {{#  } else if(d.rank == 6){ }}
    <span class="seraph vip6 icon-vip6"></span>
    {{#  } else if(d.rank == 7){ }}
    <span class="seraph vip7 icon-vip7"></span>
    {{#  } else if(d.rank == 8){ }}
    <span class="seraph vip8 icon-vip8"></span>
    {{#  } else if(d.rank == 9){ }}
    <span class="seraph vip9 icon-vip9"></span>
    {{#  } else if(d.rank == 10){ }}
    <span class="seraph vip10 icon-vip10"></span>
    {{#  }}}
</script>
<script type="text/javascript" src="/resources/layui/layui.js"></script>
<script type="text/javascript" src="/resources/js/echarts.min.js"></script>
<script type="text/javascript">

    // è·å–å½“å‰ç™»å½•ç”¨æˆ·å
    var username = "[[${session.user.name}]]";
    //è·å–ç³»ç»Ÿæ—¶é—´
    var newDate = '';
    getLangDate();

    //å€¼å°äº10æ—¶ï¼Œåœ¨å‰é¢è¡¥0
    function dateFilter(date) {
        if (date < 10) {
            return "0" + date;
        }
        return date;
    }

    function getLangDate() {
        var dateObj = new Date(); //è¡¨ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´çš„Dateå¯¹è±¡
        var year = dateObj.getFullYear(); //å½“å‰ç³»ç»Ÿæ—¶é—´çš„å®Œæ•´å¹´ä»½å€¼
        var month = dateObj.getMonth() + 1; //å½“å‰ç³»ç»Ÿæ—¶é—´çš„æœˆä»½å€¼
        var date = dateObj.getDate(); //å½“å‰ç³»ç»Ÿæ—¶é—´çš„æœˆä»½ä¸­çš„æ—¥
        var day = dateObj.getDay(); //å½“å‰ç³»ç»Ÿæ—¶é—´ä¸­çš„æ˜ŸæœŸå€¼
        var weeks = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
        var week = weeks[day]; //æ ¹æ®æ˜ŸæœŸå€¼ï¼Œä»æ•°ç»„ä¸­è·å–å¯¹åº”çš„æ˜ŸæœŸå­—ç¬¦ä¸²
        var hour = dateObj.getHours(); //å½“å‰ç³»ç»Ÿæ—¶é—´çš„å°æ—¶å€¼
        var minute = dateObj.getMinutes(); //å½“å‰ç³»ç»Ÿæ—¶é—´çš„åˆ†é’Ÿå€¼
        var second = dateObj.getSeconds(); //å½“å‰ç³»ç»Ÿæ—¶é—´çš„ç§’é’Ÿå€¼
        var timeValue = "" + ((hour >= 12) ? (hour >= 18) ? "æ™šä¸Š" : "ä¸‹åˆ" : "ä¸Šåˆ"); //å½“å‰æ—¶é—´å±äºä¸Šåˆã€æ™šä¸Šè¿˜æ˜¯ä¸‹åˆ
        newDate = dateFilter(year) + "å¹´" + dateFilter(month) + "æœˆ" + dateFilter(date) + "æ—¥ " + " " + dateFilter(hour) + ":" + dateFilter(minute) + ":" + dateFilter(second);
        document.getElementById("nowTime").innerHTML = "äº²çˆ±çš„ã€" + username + "ã€‘ï¼Œ" + timeValue + "å¥½ï¼ æ¬¢è¿ä½¿ç”¨å›¾ä¹¦ç®¡ç†ç³»ç»Ÿã€‚å½“å‰æ—¶é—´ä¸ºï¼š " + newDate + "ã€€" + week;
        setTimeout("getLangDate()", 1000);
    }

    layui.use(['form', 'element', 'layer', 'jquery', 'flow', 'table', 'laytpl', 'laydate'], function () {
        var form = layui.form;
        var layer = layui.layer;
        var element = layui.element;
        var flow = layui.flow;
        var table = layui.table;
        var laytpl = layui.laytpl;
        var laydate = layui.laydate;
        var $ = layui.jquery;

        // å®šä¹‰å›¾ä¹¦å€Ÿé˜…çš„å¼¹å‡ºå±‚
        var addOrUpdateLayerIndex;

        // å®šä¹‰è¿˜ä¹¦æˆªæ­¢æ—¥
        var dateTime = new Date();

        // åˆå§‹åŒ–é¢„æœŸè¿˜ä¹¦æ—¶é—´é€‰æ‹©å™¨
        laydate.render({
            elem: '#expectTime',
            type: 'date',
            range: true,
            istoday: true,
            min: dateTime.setDate(dateTime.getDate() + 1),
            max: dateTime.setMonth(dateTime.getMonth() + 1),
            theme: '#4d99cf'
        });

        // å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºjsonå¯¹è±¡
        $.extend({
            /* è§£æä¸ºJSON */
            "parseJSON": function (str) {
                var strArr = str.split("&");
                var searchJSON = {};
                $.each(strArr, function (index, item) {
                    var newItem = item.split("=");
                    searchJSON[newItem[0]] = decodeURIComponent(newItem[1]);
                });
                return searchJSON;
            }
        });

        //ä¸Šæ¬¡ç™»å½•æ—¶é—´ã€æ­¤å¤„åº”è¯¥ä»æ¥å£è·å–ï¼Œå®é™…ä½¿ç”¨ä¸­è¯·è‡ªè¡Œæ›´æ¢ã€‘
        // $("#nextTime").html("ä¸Šæ¬¡ç™»å½•æ—¶é—´ï¼š" + newDate.split("æ—¥")[0] + "æ—¥ " + newDate.split("æ—¥")[1]);
        $.get('/index/getLastLoginTime', function (res) {
            $("#nextTime").html("ä¸Šæ¬¡ç™»å½•æ—¶é—´ï¼š" + res.data.logintime);
        });

        flowload_popular();
        // åŠ è½½æœ€å—æ¬¢è¿çš„ä¹¦ç±æ’è¡Œ
        function flowload_popular() {
            flow.load({
                elem: '#bookRack_popular' //æµåŠ è½½å®¹å™¨
                , isAuto: false
                , isLazyimg: true
                , done: function (page, next) { //åŠ è½½ä¸‹ä¸€é¡µ
                    //æ¨¡æ‹Ÿæ’å…¥
                    setTimeout(function () {
                        var lis = [];
                        var info = { pageNum: page, pageSize: 3, putaway: 1 };
                        console.log("info:", info);
                        $.get('/book/getPageBookByPopular', info, function (res) {
                            lis.push('<ul id="grid" class="group">');
                            layui.each(res.list, function (index, item) {

                                //æ‰§è¡Œä¸‹ä¸€é¡µæ¸²æŸ“ï¼Œç¬¬äºŒå‚æ•°ä¸ºï¼šæ»¡è¶³â€œåŠ è½½æ›´å¤šâ€çš„æ¡ä»¶ï¼Œå³åé¢ä»æœ‰åˆ†é¡µ
                                //æµåŠ è½½æ’å…¥å†…å®¹éƒ¨åˆ†ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ›´æ”¹ï¼Œè¿™é‡Œåšçš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥å°±å†™çš„æ¯”è¾ƒç®€å•
                                lis.push('<li>' +
                                    '       <a onclick="readBook(\''+ $.param(item) +'\'); return false;" href="#">' +
                                    '           <img src="'+item.src+'" alt="'+item.alt+'" style="box-shadow: 2px 2px 14px 4px rgba(0, 0, 0, 0.35);"/>' +
                                    '           <p style="margin-top:2px; font-weight: bold; color: #FD482C">ã€ '+item.name+' ã€‘</p>' +
                                    '       </a>' +
                                    '     </li>'
                                );
                            });
                            lis.push('</ul><img src="/resources/images/5_gc.jpg" height="19" class="gc" alt=""/>');
                            //totalä¸ºAjaxè¿”å›çš„æ€»é¡µæ•°ï¼Œåªæœ‰å½“å‰é¡µå°äºæ€»é¡µæ•°çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šç»§ç»­å‡ºç°åŠ è½½æ›´å¤š
                            next(lis.join(''), page < 2); // è®¾ç½®æœ€å¤§é¡µé¢ä¸º2é¡µ
                            // å®šä¹‰ä¹¦æ¶ä¸Šçš„ä¹¦
                            var book_image = $(".mainmenu li a img");
                            //è®¾ç½®å›¾ç‰‡çš„é«˜åº¦
                            book_image.height(Number(book_image.width()) * 1.3);
                        })
                    }, 500);
                }
            });
        }

        flowload_putaway();
        // åŠ è½½æœ€æ–°ä¸Šæ¶çš„ä¹¦ç±æ’è¡Œ
        function flowload_putaway() {
            flow.load({
                elem: '#bookRack_putaway' //æµåŠ è½½å®¹å™¨
                , isAuto: false
                , isLazyimg: true
                , done: function (page, next) { //åŠ è½½ä¸‹ä¸€é¡µ
                    //æ¨¡æ‹Ÿæ’å…¥
                    setTimeout(function () {
                        var lis = [];
                        var info = { pageNum: page, pageSize: 3, putaway: 1 };
                        console.log("info:", info);
                        $.get('/book/getPageBook', info, function (res) {
                            lis.push('<ul id="grid" class="group">');
                            layui.each(res.list, function (index, item) {

                                //æ‰§è¡Œä¸‹ä¸€é¡µæ¸²æŸ“ï¼Œç¬¬äºŒå‚æ•°ä¸ºï¼šæ»¡è¶³â€œåŠ è½½æ›´å¤šâ€çš„æ¡ä»¶ï¼Œå³åé¢ä»æœ‰åˆ†é¡µ
                                //æµåŠ è½½æ’å…¥å†…å®¹éƒ¨åˆ†ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ›´æ”¹ï¼Œè¿™é‡Œåšçš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥å°±å†™çš„æ¯”è¾ƒç®€å•
                                lis.push('<li>' +
                                    '       <a onclick="readBook(\''+ $.param(item) +'\'); return false;" href="#">' +
                                    '           <img src="'+item.src+'" alt="'+item.alt+'" style="box-shadow: 2px 2px 14px 4px rgba(0, 0, 0, 0.35);"/>' +
                                    '           <p style="margin-top:2px; font-weight: bold; color: #FD482C">ã€ '+item.name+' ã€‘</p>' +
                                    '       </a>' +
                                    '     </li>'
                                );
                            });
                            lis.push('</ul><img src="/resources/images/5_gc.jpg" height="19" class="gc" alt=""/>');
                            //totalä¸ºAjaxè¿”å›çš„æ€»é¡µæ•°ï¼Œåªæœ‰å½“å‰é¡µå°äºæ€»é¡µæ•°çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šç»§ç»­å‡ºç°åŠ è½½æ›´å¤š
                            next(lis.join(''), page < 2); // è®¾ç½®æœ€å¤§é¡µé¢ä¸º2é¡µ
                            // å®šä¹‰ä¹¦æ¶ä¸Šçš„ä¹¦
                            var book_image = $(".mainmenu li a img");
                            //è®¾ç½®å›¾ç‰‡çš„é«˜åº¦
                            book_image.height(Number(book_image.width()) * 1.3);
                        })
                    }, 500);
                }
            });
        }

        // åŠ è½½ç”¨æˆ·æ’è¡Œ
        table.render({
            elem: '#userGrade',
            url : '/index/getTopTenRank',
            cellMinWidth : 95,
            even: true,           //å¼€å¯éš”è¡ŒèƒŒæ™¯
            response: {
                statusName: 'code'          //è§„å®šæ•°æ®çŠ¶æ€çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šcode
                , statusCode: 200           //è§„å®šæˆåŠŸçš„çŠ¶æ€ç ï¼Œé»˜è®¤ï¼š0
                , dataName: 'list'          //è§„å®šæ•°æ®åˆ—è¡¨çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šdata
            },
            title: 'å€Ÿé˜…å‰åæ’è¡Œè¡¨',
            cols : [ [
                {type: 'numbers', title: 'åºå·', width: 60, fixed:"left", align:'center'},
                {field: 'rank', title: 'æ’åå¾½ç« ', templet:'#gradeIcon', align:'center'},
                {field: 'loginname', title: 'ç”¨æˆ·å',  align:'center'},
                {field: 'number', title: 'å€Ÿé˜…æ•°é‡', sort:"true", align:'center'}
            ] ]
        });

        //è®¾ç½®å›¾ç‰‡çš„é«˜åº¦
        $(window).resize(function(){
            // å®šä¹‰ä¹¦æ¶ä¸Šçš„ä¹¦
            var book_image = $(".mainmenu li a img");
            book_image.height(Number(book_image.width()) * 1.3);
        })

        // ä¹¦ç±é˜…è¯» äº‹ä»¶
        readBook = function (data) {
            console.log("ä¹¦ç±ä¿¡æ¯ï¼š", data);
            console.log("ä¹¦ç±ä¿¡æ¯ï¼š", $.parseJSON(data));
            var bookinfo = $.parseJSON(data);
            layer.open({
                type: 2,    // iframeå±‚-çˆ¶å­æ“ä½œ
                // title:['ğŸ“œ åœ¨çº¿é˜…è¯»', 'font-size:18px; color:#07c462'],
                area: ['70%', '85%'],
                fixed: false, // ä¸å›ºå®š
                maxmin: true,
                resize: true, // å…è®¸æ‹–æ‹½å¤§å°
                content: '/sys/toOnlineReading', // éœ€è¦è·³è½¬çš„åœ°å€ï¼Œæˆ–è€…æ˜¯é™æ€æ–‡ä»¶
                btn: ['<i class="layui-icon" id="borrowBtn">&#xe609; å€Ÿé˜…æ­¤ä¹¦</i>', '<i class="layui-icon">&#x1006; å…³é—­é¡µé¢</i>'],
                yes: function(index, layero){
                    //æŒ‰é’®ã€æŒ‰é’®ä¸€ã€‘çš„å›è°ƒ

                    // åˆ¤æ–­æ­¤ä¹¦æ˜¯å¦å·²è¢«å€Ÿé˜…,æ¨èä½¿ç”¨åŒæ­¥æ–¹å¼å•Š
                    var flag = true;
                    // $.get('/borrow/getBorrowRecords',{loginname: "[[${session.user.loginname}]]", booknum: bookinfo.booknum}, function (res) {
                    //     if (res.code === 200 ) {
                    //         layer.msg(res.msg);
                    //         flag = false;
                    //     }
                    // });
                    $.ajax({
                        type: "get",
                        url: "/borrow/getBorrowRecords",
                        data: 'loginname='+"[[${session.user.loginname}]]"+'&booknum=' + bookinfo.booknum,
                        datatype: "json",
                        async: false,
                        success: function (response) {
                            if (response.code === 200 ) {
                                layer.msg(response.msg);
                                flag = false;
                                $("#borrowBtn").html("&#xe609; ä¸å¯å€Ÿé˜…").attr("disabled", "disabled").addClass("layui-disabled");
                            } else {
                                //è®¾ç½®å€Ÿé˜…æŒ‰é’® æ¢å¤å¯ç‚¹å‡»   åœ¨å‰ç«¯é˜²æ­¢ é‡å¤ç‚¹å‡»
                                $("#borrowBtn").html("&#xe609; å€Ÿé˜…æ­¤ä¹¦").attr("disabled", false).removeClass("layui-disabled");
                            }
                        }
                    });
                    if (!flag) {
                        return false;
                    }

                    // è®¤è¯ç”¨æˆ·èº«ä»½ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯æœ¬äººè¿›è¡Œå€Ÿé˜…
                    layer.confirm('ä½ ç¡®å®šè¦å€Ÿé˜…ã€' + bookinfo.name + 'ã€‘è¿™æœ¬ä¹¦å—?', {icon: 3, title: 'æç¤º'}, function (index) {
                        //promptå±‚
                        layer.prompt({title: 'æˆ‘ä»¬éœ€è¦æ‚¨è¾“å…¥<b>ç™»å½•å¯†ç </b>ï¼Œä»¥ç¡®è®¤æ‚¨çš„èº«ä»½', formType: 1}, function (pass, index) {
                            layer.close(index);
                            $.ajax({
                                type: "get",
                                url: "/user/checkUser",
                                data: 'pwd=' + pass,
                                datatype: "json",
                                async: false,
                                success: function (response) {
                                    if (response.code !== 200) {
                                        layer.msg(response.msg);
                                        return false;
                                    }
                                    // æ‰“å¼€å¼¹å‡ºå±‚ï¼Œç”¨æˆ·è¾“å…¥å€Ÿé˜…ä¿¡æ¯ï¼Œå®Œæˆå€Ÿé˜…
                                    addOrUpdateLayerIndex = layer.open({
                                        type: 1,
                                        anim: 2,
                                        content: $("#addOrUpdateLayer"),
                                        area: ['55%', '80%'],
                                        title: ['ğŸ“ å¡«å†™ä¿¡æ¯', 'font-size:18px; color:#07c462'],
                                        success: function () {
                                            // ç»™å›¾ä¹¦åºåˆ—å·èµ‹å€¼
                                            $("#booknum2").val(bookinfo.booknum);
                                            $("#expectTime").val("");
                                        }
                                    });
                                }
                            });

                        });
                    });
                },
                btn2: function(index, layero){
                    //æŒ‰é’®ã€æŒ‰é’®äºŒã€‘çš„å›è°ƒ
                    //return false å¼€å¯è¯¥ä»£ç å¯ç¦æ­¢ç‚¹å‡»è¯¥æŒ‰é’®å…³é—­
                },
                cancel: function(){
                    //å³ä¸Šè§’å…³é—­å›è°ƒ
                    //return false å¼€å¯è¯¥ä»£ç å¯ç¦æ­¢ç‚¹å‡»è¯¥æŒ‰é’®å…³é—­
                },
                success: function(layero){
                    //æ­¤idä¸ºé¡µé¢å±‚inputæ ‡ç­¾id
                    var jquerySendHelloButton = $("#book", layero.find("iframe")[0].contentWindow.document);
                    //è¦ä¼ çš„å€¼
                    jquerySendHelloButton.attr("value", data );
                }
            });
        }

        // å€Ÿé˜…å›¾ä¹¦å¼¹å‡ºå±‚æäº¤äº‹ä»¶
        form.on('submit(addBorrow)',function () {

            // åºåˆ—åŒ–è¡¨å•å†…å®¹
            var expectTime = $("#expectTime");
            // æˆªå–å€’æ•°10ä½å­—ç¬¦
            expectTime.val(expectTime.val().substr(-10,10) + " 23:59:59");
            console.log("é¢„æœŸæ—¶é—´ï¼š" + expectTime.val());
            var data = $("#addOrUpdateForm").serialize();
            console.log("æ–°å¢ã€ä¿®æ”¹å¼¹å‡ºå±‚çš„åºåˆ—åŒ–æ•°æ®ï¼š", data);

            $.post("/borrow/addBorrow", data, function (res) {

                if (res.code === 200) {
                    layer.close(addOrUpdateLayerIndex);
                }
                layer.msg(res.msg);
            })
        })

        /*########################################################################*/

        // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
        var myChart = echarts.init(document.getElementById('mainECharts'));

        // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
        var dataChart = genData();

        var option;
        // å›¾ä¹¦åˆ†ç±»æ¯”ä¾‹ç»Ÿè®¡å›¾
        option = {
            title: {
                text: 'å›¾ä¹¦åˆ†ç±»æ¯”ä¾‹ç»Ÿè®¡å›¾',
                subtext: '[é¥¼å›¾]',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b} : {c} ({d}%)'
            },
            legend: {
                type: 'scroll',
                orient: 'vertical',
                left: 'left',
                top: 20,
                bottom: 20,
                data: dataChart.legendData,
                selected: dataChart.selected
            },
            //è®¾ç½®é¥¼çŠ¶å›¾æ¯ä¸ªé¢œè‰²å—çš„é¢œè‰²
            color: ['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc'],
            series: [
                {
                    name: 'åˆ†ç±»',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: false,
                    center: ['50%', '50%'],
                    data: dataChart.seriesData,
                    itemStyle: {
                        borderRadius: 6,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: false,
                        position: 'center',
                        formatter: '{b} \n {c} ({d}%)'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: '20',
                            fontWeight: 'bold'
                        }
                    },
                    labelLine: {
                        show: false
                    }
                }
            ]
        };

        // è·å–å›¾ä¹¦åˆ†ç±»æ¯”ä¾‹ç»Ÿè®¡å›¾æ•°æ®
        function genData() {

            var legendData = [];
            var seriesData = [];
            var selected = {};

            // ä½¿ç”¨ajaxï¼Œä»åå°è·å–å›¾ä¹¦åˆ†ç±»æ¯”ä¾‹ç»Ÿè®¡å›¾æ•°æ®
            $.ajax({
                type: "get",
                url: '/index/getCategoryRatio',
                dataType: "json",
                async: false,
                success: function (res) {
                    var data = res.list;
                    console.log("å›¾ä¹¦åˆ†ç±»æ¯”ä¾‹ç»Ÿè®¡å›¾ ï¼š", data);

                    for (var i = 0; i < data.length; i++) {
                        console.log("æ•°æ®ï¼š", data[i].categoryName);
                        legendData.push(data[i].categoryName);
                        seriesData.push({
                            name: data[i].categoryName,
                            value: data[i].categoryNumber
                        });
                    }
                    selected[name] = i < data.length;
                }
            });

            return {
                legendData: legendData,
                seriesData: seriesData,
                selected: selected
            };
        }

        // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
        myChart.setOption(option);
    })

</script>

</body>
</html>
